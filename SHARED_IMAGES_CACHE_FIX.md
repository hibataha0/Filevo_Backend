# ğŸ–¼ï¸ Ø¥ØµÙ„Ø§Ø­: Ø¸Ù‡ÙˆØ± ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©

## ğŸ¯ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ù…Ø´ØªØ±ÙƒØ©ØŒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø§ ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ø¨Ø³Ø¨Ø¨:
1. Ø§Ù„Ù…ØªØµÙØ­ ÙŠÙ‚ÙˆÙ… Ø¨Ù€ cache Ù„Ù„ØµÙˆØ±
2. Ø­ØªÙ‰ Ù„Ùˆ ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø³Ø§Ø±ØŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¹ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©

## âœ… Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©

### 1. Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
ØªÙ… ØªØ¹Ø¯ÙŠÙ„ `updateFileContent` Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… replace mode ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ø­ØªÙ‰ Ø§Ù„ØµÙˆØ±):
- âœ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù‚Ø¯ÙŠÙ…
- âœ… ÙˆØ¶Ø¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø³Ø§Ø±
- âœ… ØªØ­Ø¯ÙŠØ« `updatedAt` ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### 2. Ù…Ù†Ø¹ Ø§Ù„Ù€ Cache Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
ØªÙ… ØªØ¹Ø¯ÙŠÙ„ `viewFile` Ù„Ø¥Ø¶Ø§ÙØ© headers Ù„Ù…Ù†Ø¹ Ø§Ù„Ù€ cache Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©:
- âœ… `Cache-Control: no-cache, no-store, must-revalidate`
- âœ… `Pragma: no-cache`
- âœ… `Expires: 0`
- âœ… `ETag` Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ `updatedAt` Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…ØªØµÙØ­ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª

## ğŸ”§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ù†ÙØ°Ø©

### ØªØ¹Ø¯ÙŠÙ„ 1: `updateFileContent` ÙÙŠ `services/fileService.js`

```javascript
// âœ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ù Ù…Ø´Ø§Ø±ÙƒØ§Ù‹ØŒ Ø§Ø³ØªØ®Ø¯Ù… replace mode ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­ØªÙ‰ Ù„Ù„ØµÙˆØ±
const isShared = file.isShared === true || hasSharedUsers;

const replaceMode = isTextFile || isShared
  ? true
  : req.body.replaceMode === "true" || req.body.replaceMode === true;
```

### ØªØ¹Ø¯ÙŠÙ„ 2: `viewFile` ÙÙŠ `services/fileService.js`

```javascript
// âœ… Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©: Ù…Ù†Ø¹ Ø§Ù„Ù€ cache Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
const isSharedFile = file.isShared === true || (file.sharedWith && file.sharedWith.length > 0);
const isImage = file.category === "Images" || mimeType.startsWith("image/");

if (isSharedFile && isImage) {
  // âœ… Ù…Ù†Ø¹ Ø§Ù„Ù€ cache Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
  res.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
  res.setHeader("Pragma", "no-cache");
  res.setHeader("Expires", "0");
  // âœ… Ø¥Ø¶Ø§ÙØ© ETag Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ updatedAt
  const etag = `"${file._id}-${file.updatedAt ? file.updatedAt.getTime() : Date.now()}"`;
  res.setHeader("ETag", etag);
} else {
  // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… cache Ø¹Ø§Ø¯ÙŠ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
  res.setHeader("Cache-Control", "public, max-age=3600");
}
```

## ğŸ”„ Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„

### 1. ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ù…Ø´ØªØ±ÙƒØ©
```
PUT /api/files/:id/content
file: <new_image.jpg>

Ø§Ù„Ù†ØªÙŠØ¬Ø©:
- âœ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø³Ø§Ø±
- âœ… ØªØ­Ø¯ÙŠØ« updatedAt ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- âœ… Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«
```

### 2. Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ù…Ø´ØªØ±ÙƒØ©
```
GET /api/files/:id/view

Headers Ø§Ù„Ù…Ø±Ø³Ù„Ø©:
- âœ… Cache-Control: no-cache, no-store, must-revalidate
- âœ… Pragma: no-cache
- âœ… Expires: 0
- âœ… ETag: "fileId-timestamp"

Ø§Ù„Ù†ØªÙŠØ¬Ø©:
- âœ… Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠÙ‚ÙˆÙ… Ø¨Ù€ cache Ø§Ù„ØµÙˆØ±Ø©
- âœ… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©
- âœ… Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ØªØ¸Ù‡Ø± ÙÙˆØ±Ø§Ù‹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
```

## ğŸ“‹ Ø§Ù„Ù…ÙŠØ²Ø§Øª

- âœ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
- âœ… Ù…Ù†Ø¹ Ø§Ù„Ù€ cache Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
- âœ… ETag Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
- âœ… ØªØ­Ø¯ÙŠØ« `updatedAt` ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- âœ… logging Ù…ÙØµÙ„ Ù„Ù„ØªØªØ¨Ø¹

## âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©

1. **Ø§Ù„Ù€ Cache:**
   - Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©: Ù„Ø§ ÙŠØªÙ… cache
   - Ø§Ù„ØµÙˆØ± ØºÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©: ÙŠØªÙ… cache Ù„Ù…Ø¯Ø© Ø³Ø§Ø¹Ø©
   - Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰: ÙŠØªÙ… cache Ù„Ù…Ø¯Ø© Ø³Ø§Ø¹Ø©

2. **Ø§Ù„Ø£Ø¯Ø§Ø¡:**
   - Ù…Ù†Ø¹ Ø§Ù„Ù€ cache Ù‚Ø¯ ÙŠØ²ÙŠØ¯ Ù…Ù† Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ bandwidth
   - Ù„ÙƒÙ†Ù‡ ÙŠØ¶Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙˆØ±Ø§Ù‹

3. **ETag:**
   - ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ `file._id` Ùˆ `updatedAt`
   - ÙŠØ³Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØµÙØ­ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª

## âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª

- âœ… ØªØ¹Ø¯ÙŠÙ„ `updateFileContent` Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… replace mode Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
- âœ… ØªØ¹Ø¯ÙŠÙ„ `viewFile` Ù„Ù…Ù†Ø¹ Ø§Ù„Ù€ cache Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
- âœ… Ø¥Ø¶Ø§ÙØ© ETag headers
- âœ… logging Ù…ÙØµÙ„

## ğŸ“„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©

1. âœ… `services/fileService.js` - ØªØ¹Ø¯ÙŠÙ„ `updateFileContent` Ùˆ `viewFile`

## ğŸ‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©

Ø§Ù„Ø¢Ù†:
- âœ… Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø³Ø§Ø±
- âœ… Ø§Ù„Ù€ cache ÙŠØªÙ… Ù…Ù†Ø¹Ù‡ Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
- âœ… Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ØªØ¸Ù‡Ø± ÙÙˆØ±Ø§Ù‹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
- âœ… Ù†ÙØ³ Ø§Ù„Ø³Ù„ÙˆÙƒ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†ØµÙŠØ© ÙˆØ§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©

## ğŸ” Debugging

Ø¥Ø°Ø§ Ù„Ù… ØªØ¸Ù‡Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª:
1. ØªØ­Ù‚Ù‚ Ù…Ù† console logs:
   - `ğŸ” File sharing check` - Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù…Ø´Ø§Ø±Ùƒ
   - `ğŸ”„ Replace mode` - Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… replace mode
   - `âœ… File content updated successfully` - Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ø¯ÙŠØ«

2. ØªØ­Ù‚Ù‚ Ù…Ù† headers ÙÙŠ response:
   - `Cache-Control` ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† `no-cache, no-store, must-revalidate` Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
   - `ETag` ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØºÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«

3. ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­:
   - Ø§Ø¶ØºØ· Ctrl+Shift+R (Ø£Ùˆ Cmd+Shift+R) Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¨Ø¯ÙˆÙ† cache
   - Ø£Ùˆ Ø§ÙØªØ­ Developer Tools > Network > Disable cache












