# ๐ง ุฅุตูุงุญ: ุชุญุฏูุซ ุงูููู ุงูููุฌูุฏ ุจุฏูุงู ูู ุฅุถุงูุฉ ููู ุฌุฏูุฏ

## ๐ฏ ุงููุดููุฉ
ุนูุฏ ุชุญุฏูุซ ูุญุชูู ููู (ุฎุงุตุฉ ุงูุตูุฑ) ูุน ุงุฎุชูุงุฑ ุงุณุชุจุฏุงู ุงููุณุฎุฉ ุงููุฏููุฉุ ูุงู ูุชู ุฅุถุงูุฉ ููู ุฌุฏูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุฏูุงู ูู ุชุญุฏูุซ ุงูููู ุงูููุฌูุฏ.

## โ ุงูุญู
ุชู ุชุบููุฑ ุทุฑููุฉ ุงูุชุญุฏูุซ ูู `file.save()` ุฅูู `File.findByIdAndUpdate()` ูุถูุงู ุชุญุฏูุซ ุงูููู ุงูููุฌูุฏ ููุท ูููุณ ุฅูุดุงุก ููู ุฌุฏูุฏ.

## ๐ง ุงูุชุนุฏูู ุงููููุฐ

### ูุจู ุงูุชุนุฏูู:
```javascript
// โ ุชุญุฏูุซ ูุนูููุงุช ุงูููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
file.path = finalFilePath;
file.size = newFileSize;
file.type = newFileType;
file.category = newCategory;
file.name = finalFileName;
file.updatedAt = new Date();

// โ ุญูุธ ุงูุชุบููุฑุงุช
await file.save();
```

### ุจุนุฏ ุงูุชุนุฏูู:
```javascript
// โ ุชุญุฏูุซ ูุนูููุงุช ุงูููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู findByIdAndUpdate
// โ ูุฐุง ูุถูู ุชุญุฏูุซ ุงูููู ุงูููุฌูุฏ ูููุณ ุฅูุดุงุก ููู ุฌุฏูุฏ
const updateData = {
  path: finalFilePath,
  size: newFileSize,
  type: newFileType,
  category: newCategory,
  name: finalFileName,
  updatedAt: new Date(),
  // โ ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงููุนุงูุฌุฉ ูุฃู ุงูููู ุชุบูุฑ
  isProcessed: false,
  processedAt: null,
  extractedText: null,
  embedding: null,
  summary: null,
};

// โ ุงุณุชุฎุฏุงู findByIdAndUpdate ููุชุฃูุฏ ูู ุชุญุฏูุซ ุงูููู ุงูููุฌูุฏ ููุท
const updatedFile = await File.findByIdAndUpdate(
  fileId,
  { $set: updateData },
  { new: true, runValidators: true }
);

if (!updatedFile) {
  throw new Error("Failed to update file in database");
}
```

## ๐ ุงููุฑู ุจูู `save()` ู `findByIdAndUpdate()`

### `file.save()`
- ูุนุชูุฏ ุนูู ุญุงูุฉ ุงููุงุฆู ุงูุญุงูู
- ูุฏ ูุณุจุจ ูุดุงูู ุฅุฐุง ุชุบูุฑุช ุญุงูุฉ ุงููุงุฆู
- ูุฏ ูุง ูุญุฏุซ ุงูููู ุจุดูู ุตุญูุญ ูู ุจุนุถ ุงูุญุงูุงุช

### `findByIdAndUpdate()`
- ูุญุฏุซ ุงูููู ูุจุงุดุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุถูู ุชุญุฏูุซ ุงูููู ุงูููุฌูุฏ ููุท
- ุฃูุซุฑ ููุซูููุฉ ูุฃูุงูุงู
- ูุนูุฏ ุงูููู ุงููุญุฏุซ ูุจุงุดุฑุฉ

## โ ุงูููุฒุงุช

- โ ุชุญุฏูุซ ุงูููู ุงูููุฌูุฏ ููุท (ูุง ูุชู ุฅูุดุงุก ููู ุฌุฏูุฏ)
- โ ุงุณุชุฎุฏุงู `findByIdAndUpdate` ูุถูุงู ุงูุชุญุฏูุซ ุงูุตุญูุญ
- โ ุงูุชุญูู ูู ูุฌุงุญ ุงูุชุญุฏูุซ
- โ logging ููุตู ููุชุชุจุน
- โ ุฅุฑุฌุงุน ุงูููู ุงููุญุฏุซ ูู ุงูุงุณุชุฌุงุจุฉ

## ๐ ุณูุฑ ุงูุนูู

1. **ุฌูุจ ุงูููู ุงูููุฌูุฏ:**
   ```javascript
   const file = await File.findOne({ _id: fileId, userId: userId });
   ```

2. **ูุนุงูุฌุฉ ุงูููู ุงูุฌุฏูุฏ:**
   - ุญุฐู ุงูููู ุงููุฏูู (ูู replace mode)
   - ูุณุฎ ุงูููู ุงูุฌุฏูุฏ ุฅูู ููุงู ุงููุฏูู (ูู replace mode)

3. **ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
   ```javascript
   const updatedFile = await File.findByIdAndUpdate(
     fileId,
     { $set: updateData },
     { new: true, runValidators: true }
   );
   ```

4. **ุงูุชุญูู ูู ุงููุฌุงุญ:**
   ```javascript
   if (!updatedFile) {
     throw new Error("Failed to update file in database");
   }
   ```

## ๐ Logging

ุชู ุฅุถุงูุฉ logging ููุตู:
```javascript
console.log("โ File content updated successfully:", fileId);
console.log("โ Updated file ID:", updatedFile._id);
console.log("โ File path:", updatedFile.path);
console.log("โ File name:", updatedFile.name);
```

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **`findByIdAndUpdate` vs `save()`:**
   - `findByIdAndUpdate` ุฃูุซุฑ ููุซูููุฉ ููุชุญุฏูุซุงุช
   - ูุถูู ุชุญุฏูุซ ุงูููู ุงูููุฌูุฏ ููุท
   - ูุง ููููู ุฅูุดุงุก ููู ุฌุฏูุฏ (ูุญุชุงุฌ `_id` ููุฌูุฏ)

2. **`{ new: true }`:**
   - ูุนูุฏ ุงูููู ุงููุญุฏุซ ุจุฏูุงู ูู ุงูููู ุงููุฏูู
   - ูููุฏ ููุญุตูู ุนูู ุงูุจูุงูุงุช ุงููุญุฏุซุฉ ูุจุงุดุฑุฉ

3. **`runValidators: true`:**
   - ูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูุจู ุงูุชุญุฏูุซ
   - ูุถูู ุฃู ุงูุจูุงูุงุช ุงููุญุฏุซุฉ ุตุญูุญุฉ

## โ ุงูุชุญูู ูู ุงูุชุนุฏููุงุช

- โ ุงุณุชุฎุฏุงู `findByIdAndUpdate` ุจุฏูุงู ูู `save()`
- โ ุงูุชุญูู ูู ูุฌุงุญ ุงูุชุญุฏูุซ
- โ ุฅุฑุฌุงุน ุงูููู ุงููุญุฏุซ ูู ุงูุงุณุชุฌุงุจุฉ
- โ logging ููุตู
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ุฌุฏูุฏุฉ ูู linter

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

1. โ `services/fileService.js` - ุชุนุฏูู ุฏุงูุฉ `updateFileContent`

## ๐ ุงููุชูุฌุฉ

ุงูุขู:
- โ ุนูุฏ ุชุญุฏูุซ ููู ูุน replace modeุ ูุชู ุชุญุฏูุซ ุงูููู ุงูููุฌูุฏ ููุท
- โ ูุง ูุชู ุฅูุดุงุก ููู ุฌุฏูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ููุณ `_id` ูุจูู ููุง ูู
- โ ุฌููุน ุงูุจูุงูุงุช ูุชู ุชุญุฏูุซูุง ุจุดูู ุตุญูุญ

## ๐ Debugging

ุฅุฐุง ูุงู ูุง ูุฒุงู ูุชู ุฅูุดุงุก ูููุงุช ุฌุฏูุฏุฉ:
1. ุชุญูู ูู console logs:
   - `โ Updated file ID:` - ูุฌุจ ุฃู ูููู ููุณ `fileId`
   - `โ File path:` - ูุฌุจ ุฃู ูููู ููุณ ุงููุณุงุฑ (ูู replace mode)
   - `โ File name:` - ูุฌุจ ุฃู ูููู ููุณ ุงูุงุณู (ูู replace mode)

2. ุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
   - ูุฌุจ ุฃู ูููู ููุงู ููู ูุงุญุฏ ููุท ุจููุณ `_id`
   - ูุฌุจ ุฃู ูููู `path` ู `name` ูุญุฏุซูู

3. ุชุญูู ูู `replaceMode`:
   - ูุฌุจ ุฃู ูููู `true` ุนูุฏ ุงุฎุชูุงุฑ ุงุณุชุจุฏุงู
   - ูุฌุจ ุฃู ูููู `true` ุชููุงุฆูุงู ูููููุงุช ุงููุดุชุฑูุฉ









